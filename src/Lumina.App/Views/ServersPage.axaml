<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Lumina.App.ViewModels"
             xmlns:converters="using:Lumina.App.Converters"
             x:Class="Lumina.App.Views.ServersPage"
             x:DataType="vm:ServersViewModel">

    <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                  VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="16" Margin="32" MaxWidth="900" HorizontalAlignment="Center">

            <!-- Header -->
            <Border Classes="Card" Padding="24">
                <Grid ColumnDefinitions="*,Auto">
                    <StackPanel Spacing="6">
                        <TextBlock Text="{DynamicResource Servers_Title}" Classes="Display" />
                        <TextBlock Text="{DynamicResource Servers_Subtitle}" Classes="Body" />
                    </StackPanel>

                    <Button Grid.Column="1"
                            Classes="Primary"
                            VerticalAlignment="Top"
                            Command="{Binding AddServerCommand}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                                      Width="16" Height="16" />
                            <TextBlock Text="{DynamicResource Servers_Add}" />
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <!-- Search Box -->
            <Border Classes="Card" Padding="16">
                <TextBox Classes="Lumina"
                         Watermark="{DynamicResource Servers_Search}"
                         Text="{Binding SearchQuery}">
                    <TextBox.InnerLeftContent>
                        <PathIcon Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource TextMuted}"
                                  Margin="12,0,0,0" />
                    </TextBox.InnerLeftContent>
                </TextBox>
            </Border>

            <Border Classes="Card" 
                    IsVisible="{Binding ConnectError, Converter={x:Static converters:StringConverters.IsNotNullOrEmpty}}"
                    Background="#331E293B"
                    BorderBrush="{StaticResource ErrorBrush}">
                <StackPanel Spacing="8">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                                  Width="20" Height="20"
                                  Foreground="{StaticResource ErrorBrush}" />
                        <TextBlock Text="{DynamicResource Home_DriverInitFailedTitle}" Classes="BodyStrong" />
                    </StackPanel>
                    <TextBlock Text="{Binding ConnectError}"
                               Classes="Body"
                               TextWrapping="Wrap" />
                </StackPanel>
            </Border>

            <StackPanel Spacing="24">

                <!-- Favorites -->
                <StackPanel Spacing="12" IsVisible="{Binding HasFavoriteServers}">
                    <TextBlock Text="{DynamicResource Servers_Favorites}" Classes="StatLabel" />
                    <Border Classes="Card" Padding="0">
                        <ItemsControl ItemsSource="{Binding FavoriteServers}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:ServerItemViewModel">
                                    <Border Classes="ServerItem">
                                        <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto">
                                            
                                            <!-- Star Icon -->
                                            <PathIcon Grid.Column="0"
                                                      Data="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                                                      Width="16" Height="16"
                                                      Foreground="{StaticResource WarningBrush}"
                                                      Margin="0,0,12,0" />

                                            <!-- Server Info -->
                                            <StackPanel Grid.Column="1" Spacing="2">
                                                <TextBlock Text="{Binding Name}" Classes="BodyStrong" />
                                                <TextBlock Text="{Binding Location}" Classes="Caption" />
                                            </StackPanel>

                                            <!-- Latency -->
                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding LatencyText}"
                                                       Classes="Caption"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,16,0" />

                                            <Button Grid.Column="3"
                                                    Classes="Secondary"
                                                    Padding="12,8"
                                                    Command="{Binding DataContext.EditServerCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <TextBlock Text="{DynamicResource Servers_Edit}" />
                                            </Button>

                                            <Button Grid.Column="4"
                                                    Classes="Secondary"
                                                    Padding="12,8"
                                                    Command="{Binding DataContext.DeleteServerCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <TextBlock Text="{DynamicResource Servers_Delete}" />
                                            </Button>

                                            <Button Grid.Column="5"
                                                    Classes="Primary"
                                                    Padding="16,8"
                                                    Command="{Binding DataContext.ConnectToServerCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <TextBlock Text="{DynamicResource Servers_Connect}" />
                                            </Button>
                                            
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Border>
                </StackPanel>

                <!-- All Servers -->
                <StackPanel Spacing="12" IsVisible="{Binding HasServers}">
                    <TextBlock Text="{DynamicResource Servers_AllServers}" Classes="StatLabel" />
                    <Border Classes="Card" Padding="0">
                        <ItemsControl ItemsSource="{Binding Servers}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:ServerItemViewModel">
                                    <Border Classes="ServerItem">
                                        <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto">
                                            
                                            <!-- Globe Icon -->
                                            <PathIcon Grid.Column="0"
                                                      Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"
                                                      Width="16" Height="16"
                                                      Foreground="{DynamicResource TextMuted}"
                                                      Margin="0,0,12,0" />

                                            <!-- Server Info -->
                                            <StackPanel Grid.Column="1" Spacing="2">
                                                <TextBlock Text="{Binding Name}" Classes="BodyStrong" />
                                                <TextBlock Text="{Binding Location}" Classes="Caption" />
                                            </StackPanel>

                                            <!-- Latency -->
                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding LatencyText}"
                                                       Classes="Caption"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,16,0" />

                                            <Button Grid.Column="3"
                                                    Classes="Secondary"
                                                    Padding="12,8"
                                                    Command="{Binding DataContext.EditServerCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <TextBlock Text="{DynamicResource Servers_Edit}" />
                                            </Button>

                                            <Button Grid.Column="4"
                                                    Classes="Secondary"
                                                    Padding="12,8"
                                                    Command="{Binding DataContext.DeleteServerCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <TextBlock Text="{DynamicResource Servers_Delete}" />
                                            </Button>

                                            <Button Grid.Column="5"
                                                    Classes="Secondary"
                                                    Padding="16,8"
                                                    Command="{Binding DataContext.ConnectToServerCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <TextBlock Text="{DynamicResource Servers_Connect}" />
                                            </Button>
                                            
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Border>
                </StackPanel>

                <!-- Empty State -->
                <Border Classes="Card" 
                        IsVisible="{Binding HasNoServers}"
                        HorizontalAlignment="Center"
                        Padding="40">
                    <StackPanel Spacing="16" HorizontalAlignment="Center">
                        <PathIcon Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"
                                  Width="48" Height="48"
                                  Foreground="{DynamicResource TextMuted}" />
                        <TextBlock Text="{DynamicResource Servers_EmptyTitle}"
                                   Classes="Title"
                                   HorizontalAlignment="Center" />
                        <TextBlock Text="{DynamicResource Servers_EmptySubtitle}"
                                   Classes="Body"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

            </StackPanel>
        </StackPanel>
    </ScrollViewer>

</UserControl>
